

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IP 地址 &mdash; blog.clanzx.net 0.1 文档</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/blog.css" type="text/css" />
  

  
        <link rel="index" title="索引"
              href="../genindex.html"/>
        <link rel="search" title="搜索" href="../search.html"/>
    <link rel="top" title="blog.clanzx.net 0.1 文档" href="../index.html"/>
        <link rel="next" title="Linux IPv6 DAD 相关配置" href="ipv6-dad.html"/>
        <link rel="prev" title="ARP" href="arp.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> blog.clanzx.net
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">硬件猎奇</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hardware/intro.html">综述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/ipmi.html">IPMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/memory.html">内存</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/smart.html">通过 SMART 查看和跟踪硬盘健康状态</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/raid.html">RAID 维护备忘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/interface.html">各种接口简述</a></li>
</ul>
<p class="caption"><span class="caption-text">软件探秘</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software/init.html">初始化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/svc.html">服务维护/管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/ops.html">日常维护</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/virtualization.html">虚拟化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/shell.html">Shell 及常用命令</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/ssl.html">SSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/nss.html">名字服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/db.html">数据库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/web.html">WEB 服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/analysis.html">数据分析</a></li>
</ul>
<p class="caption"><span class="caption-text">网络漫游</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ip-neigh.html">链路层地址（ARP/Neighbor）相关信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="arp.html">ARP</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">IP 地址</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ipv4">IPv4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ipv6">IPv6</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ipv6-dad.html">Linux IPv6 DAD 相关配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="ip-config.html">Linux 下的多 IP 地址配置方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="rp_filter.html">Linux rp_filter 配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="route.html">路由</a></li>
<li class="toctree-l1"><a class="reference internal" href="openvpn.html">使用 openvpn 实现 SSL VPN</a></li>
<li class="toctree-l1"><a class="reference internal" href="netfilter-recent.html">iptables recent 模块配置</a></li>
</ul>
<p class="caption"><span class="caption-text">开发构建</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/scms.html">配置管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/lang.html">语言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/debug.html">调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/kernel.html">内核</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/nlp.html">自然语言处理</a></li>
</ul>
<p class="caption"><span class="caption-text">天南海北</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/cards.html">各种卡片</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/rubiks_cube.html">魔方解法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/restructuredtext.html">reStructuredText 备忘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/debit.html">房贷还款计算的 python 程序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/nexus5.html">Nexus 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/sites.html">WEB 网站</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/illusion.html">错觉</a></li>
</ul>
<p class="caption"><span class="caption-text">读书笔记</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../books/evolution.html">进化 - 从孤胆极客到高效团队</a></li>
</ul>
<p class="caption"><span class="caption-text">索引/表</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">索引</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">blog.clanzx.net</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>IP 地址</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/network/address.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ip">
<h1>IP 地址<a class="headerlink" href="#ip" title="永久链接至标题">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">&#64;2012-04-20 新版功能: </span>创建， IPv6 local address</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">在 &#64;2019-02-16 版更改: </span>增加 IPv4, add more address from RFC</p>
</div>
<p>参考 <a class="reference external" href="https://en.wikipedia.org/wiki/IP_address">IP address</a></p>
<div class="section" id="ipv4">
<h2>IPv4<a class="headerlink" href="#ipv4" title="永久链接至标题">¶</a></h2>
<p><span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6890.html"><strong>RFC 6890</strong></a>, （过时：<span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5735.html"><strong>RFC 5735</strong></a>）</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="37%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Address Block</th>
<th class="head">Present Use</th>
<th class="head">Reference</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0.0.0.0/8</td>
<td>&quot;This&quot; Network</td>
<td><span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1122.html#section-3.2.1.3"><strong>RFC 1122#section-3.2.1.3</strong></a></td>
</tr>
<tr class="row-odd"><td>10.0.0.0/8</td>
<td>Private-Use Networks</td>
<td><span class="target" id="index-3"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1918.html"><strong>RFC 1918</strong></a></td>
</tr>
<tr class="row-even"><td>127.0.0.0/8</td>
<td>Loopback</td>
<td><span class="target" id="index-4"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1122.html#section-3.2.1.3"><strong>RFC 1122#section-3.2.1.3</strong></a></td>
</tr>
<tr class="row-odd"><td>100.64.0.0/10</td>
<td>Shared Address Space</td>
<td><span class="target" id="index-5"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6598.html"><strong>RFC 6598</strong></a></td>
</tr>
<tr class="row-even"><td>169.254.0.0/16</td>
<td>Link Local</td>
<td><span class="target" id="index-6"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3927.html"><strong>RFC 3927</strong></a></td>
</tr>
<tr class="row-odd"><td>172.16.0.0/12</td>
<td>Private-Use Networks</td>
<td><span class="target" id="index-7"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1918.html"><strong>RFC 1918</strong></a></td>
</tr>
<tr class="row-even"><td>192.0.0.0/24</td>
<td>IETF Protocol Assignments</td>
<td><span class="target" id="index-8"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5736.html"><strong>RFC 5736</strong></a></td>
</tr>
<tr class="row-odd"><td>192.0.0.0/29</td>
<td>DS-Lite</td>
<td><span class="target" id="index-9"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6333.html"><strong>RFC 6333</strong></a></td>
</tr>
<tr class="row-even"><td>192.0.2.0/24</td>
<td>TEST-NET-1</td>
<td><span class="target" id="index-10"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5737.html"><strong>RFC 5737</strong></a></td>
</tr>
<tr class="row-odd"><td>192.88.99.0/24</td>
<td>6to4 Relay Anycast</td>
<td><span class="target" id="index-11"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3068.html"><strong>RFC 3068</strong></a></td>
</tr>
<tr class="row-even"><td>192.168.0.0/16</td>
<td>Private-Use Networks</td>
<td><span class="target" id="index-12"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1918.html"><strong>RFC 1918</strong></a></td>
</tr>
<tr class="row-odd"><td>198.18.0.0/15</td>
<td>Network Interconnect
Device Benchmark Testing</td>
<td><span class="target" id="index-13"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2544.html"><strong>RFC 2544</strong></a></td>
</tr>
<tr class="row-even"><td>198.51.100.0/24</td>
<td>TEST-NET-2</td>
<td><span class="target" id="index-14"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5737.html"><strong>RFC 5737</strong></a></td>
</tr>
<tr class="row-odd"><td>203.0.113.0/24</td>
<td>TEST-NET-3</td>
<td><span class="target" id="index-15"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5737.html"><strong>RFC 5737</strong></a></td>
</tr>
<tr class="row-even"><td>224.0.0.0/4</td>
<td>Multicast</td>
<td><span class="target" id="index-16"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3171.html"><strong>RFC 3171</strong></a></td>
</tr>
<tr class="row-odd"><td>240.0.0.0/4</td>
<td>Reserved for Future Use</td>
<td><span class="target" id="index-17"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1112.html#section-4"><strong>RFC 1112#section-4</strong></a></td>
</tr>
<tr class="row-even"><td>255.255.255.255/32</td>
<td>Limited Broadcast</td>
<td><span class="target" id="index-18"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc919.html#section-7"><strong>RFC 919#section-7</strong></a>
<span class="target" id="index-19"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc922.html#section-7"><strong>RFC 922#section-7</strong></a></td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Private addresses</p>
<blockquote>
<div><ul class="simple">
<li>10.0.0.0/8 (10.0.0.0 - 10.255.255.255)</li>
<li>172.16.0.0/12 (172.16.0.0 – 172.31.255.255)</li>
<li>192.168.0.0/16 (192.168.0.0 – 192.168.255.255)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Shared addresses</p>
<blockquote>
<div><ul class="simple">
<li>100.64.0.0/10<ol class="arabic">
<li>However, Shared Address Space has limitations in its use that the
current [<span class="target" id="index-20"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1918.html"><strong>RFC 1918</strong></a>] private address space does not have.</li>
<li>In particular, Shared Address Space can only be used in Service
Provider networks or on routing equipment that is able to do
address translation across router interfaces when the addresses
are identical on two different interfaces.</li>
</ol>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Link local</p>
<blockquote>
<div><ul>
<li><p class="first">169.254.0.0/16</p>
<p>Allocated for communication between hosts on a single link.
Hosts obtain these addresses by auto-configuration, such as
when a DHCP server cannot be found.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="ipv6">
<h2>IPv6<a class="headerlink" href="#ipv6" title="永久链接至标题">¶</a></h2>
<p>连接测试网站： <a class="reference external" href="http://ipv6-test.com">http://ipv6-test.com</a></p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="37%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Address Block</th>
<th class="head">Present Use</th>
<th class="head">Reference</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>::1/128</td>
<td>Loopback Address</td>
<td><span class="target" id="index-21"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4291.html"><strong>RFC 4291</strong></a></td>
</tr>
<tr class="row-odd"><td>::/128</td>
<td>Unspecified Address</td>
<td><span class="target" id="index-22"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4291.html"><strong>RFC 4291</strong></a></td>
</tr>
<tr class="row-even"><td>64:ff9b::/96</td>
<td>IPv4-IPv6 Translat</td>
<td><span class="target" id="index-23"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6052.html"><strong>RFC 6052</strong></a></td>
</tr>
<tr class="row-odd"><td>::ffff:0:0/96</td>
<td>IPv4-mapped Address</td>
<td><span class="target" id="index-24"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4291.html"><strong>RFC 4291</strong></a></td>
</tr>
<tr class="row-even"><td>100::/64</td>
<td>Discard-Only Address Block</td>
<td><span class="target" id="index-25"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6666.html"><strong>RFC 6666</strong></a></td>
</tr>
<tr class="row-odd"><td>2001::/23</td>
<td>IETF Protocol Assignments</td>
<td><span class="target" id="index-26"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2928.html"><strong>RFC 2928</strong></a></td>
</tr>
<tr class="row-even"><td>2001::/32</td>
<td>TEREDO</td>
<td><span class="target" id="index-27"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4380.html"><strong>RFC 4380</strong></a></td>
</tr>
<tr class="row-odd"><td>2001:2::/48</td>
<td>Benchmarking</td>
<td><span class="target" id="index-28"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5180.html"><strong>RFC 5180</strong></a></td>
</tr>
<tr class="row-even"><td>2001:db8::/32</td>
<td>Documentation</td>
<td><span class="target" id="index-29"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3849.html"><strong>RFC 3849</strong></a></td>
</tr>
<tr class="row-odd"><td>2001:10::/28</td>
<td>ORCHID (not after 201403)</td>
<td><span class="target" id="index-30"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4843.html"><strong>RFC 4843</strong></a></td>
</tr>
<tr class="row-even"><td>2002::/16</td>
<td>6to4</td>
<td><span class="target" id="index-31"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3056.html"><strong>RFC 3056</strong></a></td>
</tr>
<tr class="row-odd"><td>fc00::/7</td>
<td>Unique-Local</td>
<td><span class="target" id="index-32"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4193.html"><strong>RFC 4193</strong></a></td>
</tr>
<tr class="row-even"><td>fe80::/10</td>
<td>Linked-Scoped Unicast</td>
<td><span class="target" id="index-33"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc4291.html"><strong>RFC 4291</strong></a></td>
</tr>
</tbody>
</table>
<p>The Local IPv6 addresses are created using a pseudo-randomly allocated
global ID.  They have the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="o">|</span> <span class="mi">7</span> <span class="n">bits</span> <span class="o">|</span><span class="mi">1</span><span class="o">|</span>  <span class="mi">40</span> <span class="n">bits</span>   <span class="o">|</span>  <span class="mi">16</span> <span class="n">bits</span>  <span class="o">|</span>          <span class="mi">64</span> <span class="n">bits</span>           <span class="o">|</span>
   <span class="o">+--------+-+------------+-----------+----------------------------+</span>
   <span class="o">|</span> <span class="n">Prefix</span> <span class="o">|</span><span class="n">L</span><span class="o">|</span> <span class="n">Global</span> <span class="n">ID</span>  <span class="o">|</span> <span class="n">Subnet</span> <span class="n">ID</span> <span class="o">|</span>        <span class="n">Interface</span> <span class="n">ID</span>        <span class="o">|</span>
   <span class="o">+--------+-+------------+-----------+----------------------------+</span>

<span class="n">Where</span><span class="p">:</span>

   <span class="n">Prefix</span>            <span class="n">FC00</span><span class="p">::</span><span class="o">/</span><span class="mi">7</span> <span class="n">prefix</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">Local</span> <span class="n">IPv6</span> <span class="n">unicast</span>
                     <span class="n">addresses</span><span class="o">.</span>

   <span class="n">L</span>                 <span class="n">Set</span> <span class="n">to</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">the</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="n">locally</span> <span class="n">assigned</span><span class="o">.</span>
                     <span class="n">Set</span> <span class="n">to</span> <span class="mi">0</span> <span class="n">may</span> <span class="n">be</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">future</span><span class="o">.</span>  <span class="n">See</span>
                     <span class="n">Section</span> <span class="mf">3.2</span> <span class="k">for</span> <span class="n">additional</span> <span class="n">information</span><span class="o">.</span>

   <span class="n">Global</span> <span class="n">ID</span>         <span class="mi">40</span><span class="o">-</span><span class="n">bit</span> <span class="k">global</span> <span class="n">identifier</span> <span class="n">used</span> <span class="n">to</span> <span class="n">create</span> <span class="n">a</span>
                     <span class="n">globally</span> <span class="n">unique</span> <span class="n">prefix</span><span class="o">.</span>  <span class="n">See</span> <span class="n">Section</span> <span class="mf">3.2</span> <span class="k">for</span>
                     <span class="n">additional</span> <span class="n">information</span><span class="o">.</span>

   <span class="n">Subnet</span> <span class="n">ID</span>         <span class="mi">16</span><span class="o">-</span><span class="n">bit</span> <span class="n">Subnet</span> <span class="n">ID</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">identifier</span> <span class="n">of</span> <span class="n">a</span> <span class="n">subnet</span>
                     <span class="n">within</span> <span class="n">the</span> <span class="n">site</span><span class="o">.</span>

   <span class="n">Interface</span> <span class="n">ID</span>      <span class="mi">64</span><span class="o">-</span><span class="n">bit</span> <span class="n">Interface</span> <span class="n">ID</span> <span class="k">as</span> <span class="n">defined</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ADDARCH</span><span class="p">]</span><span class="o">.</span>
</pre></div>
</div>
<p>Use following program to generate <em>Locally Assigned Global ID</em>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- mode: python ; ispell-local-dictionary: &quot;american&quot; -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generate &#39;Locally Assigned Global IDs&#39; according to RFC 4193</span>

<span class="sd">The Algorithm as described in the RFC:</span>

<span class="sd">     1) Obtain the current time of day in 64-bit NTP format [NTP].</span>
<span class="sd">     2) Obtain an EUI-64 identifier from the system running this</span>
<span class="sd">        algorithm.  If an EUI-64 does not exist, one can be created from</span>
<span class="sd">        a 48-bit MAC address as specified in [ADDARCH].  If an EUI-64</span>
<span class="sd">        cannot be obtained or created, a suitably unique identifier,</span>
<span class="sd">        local to the node, should be used (e.g. system serial number).</span>
<span class="sd">     3) Concatenate the time of day with the system-specific identifier</span>
<span class="sd">        creating a key.</span>
<span class="sd">     4) Compute an SHA-1 digest on the key as specified in [FIPS, SHA1];</span>
<span class="sd">        the resulting value is 160 bits.</span>
<span class="sd">     5) Use the least significant 40 bits as the Global ID.</span>
<span class="sd">     6) Concatenate FC00::/7, the L bit set to 1, and the 40 bit Global</span>
<span class="sd">        ID to create a Local IPv6 address prefix.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Required Python 2.4 (or better)</span>
<span class="c1">#</span>
<span class="c1"># History:</span>
<span class="c1"># 2012-02-09:</span>
<span class="c1">#    - Bugfix: import error.</span>
<span class="c1"># 2010-12-22:</span>
<span class="c1">#    - Bugfix: calculation of NTP format was wrong (Thanks to Sergei</span>
<span class="c1">#      Zhirikov for pointing this out)</span>
<span class="c1">#    - Bugfix: &quot;Encapsulated MAC-48 values&quot; use FFFF, not FFFE (again</span>
<span class="c1">#      thanks to Sergei Zhirikov for pointing this out)</span>
<span class="c1">#    - Enhancement: Use Python module ``uuid`` (new in Python 2.4) to</span>
<span class="c1">#      get the MAC address platform independent</span>
<span class="c1"># 2005-07-08:</span>
<span class="c1">#    - Initial Release</span>
<span class="c1">#</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Hartmut Goebel &lt;h.goebel@goebel-consult.de&gt;&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;(C) Copyright 2005-2012 by Hartmut Goebel&quot;</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="s2">&quot;GNU Public Licence (GPL), Version 3 or later&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.3.2&quot;</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">commands</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sha</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="c1"># from http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/117211</span>
<span class="n">TIME1970</span> <span class="o">=</span> <span class="il">2208988800L</span>      <span class="c1"># Thanks to F.Lundh</span>

<span class="k">def</span> <span class="nf">_get_time_ntpformat</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get current time of day in 64-bit NTP format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculation of fractal part adopted from</span>
    <span class="c1"># &lt;http://pypi.python.org/pypi/ntplib/&gt;, thanks to</span>
    <span class="c1"># Charles-Francois Natali and the NTP FAQ</span>
    <span class="c1"># &lt;http://www.ntp.org/ntpfaq/NTP-s-algo.htm#AEN1895&gt;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">TIME1970</span>
    <span class="n">int_part</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">frac_part</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">int_part</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;LL&#39;</span><span class="p">,</span> <span class="n">int_part</span><span class="p">,</span> <span class="n">frac_part</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>

<span class="k">def</span> <span class="nf">_get_EUI64</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an EUI-64 identifier from the MAC address</span>
<span class="sd">    according to &quot;Encapsulated MAC-48 values&quot; in</span>
<span class="sd">    http://standards.ieee.org/regauth/oui/tutorials/EUI64.html</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># get the MAC of some interface</span>
    <span class="n">mac</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%012x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">uuid</span><span class="o">.</span><span class="n">getnode</span><span class="p">()</span>
    <span class="n">mac</span> <span class="o">=</span> <span class="p">[</span><span class="n">mac</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mac</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="c1"># insert &#39;ffff&#39;</span>
    <span class="n">mac</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ff&#39;</span><span class="p">,</span> <span class="s1">&#39;ff&#39;</span><span class="p">]</span>
    <span class="n">mac</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">16</span><span class="p">)),</span> <span class="n">mac</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calc_LAGID</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate a single &#39;Locally Assigned Global ID&#39; according to</span>
<span class="sd">    the algorithm described above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1) current time of day in 64-bit NTP format</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">_get_time_ntpformat</span><span class="p">();</span>   <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span>        <span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">64</span>
    <span class="c1"># 2) an EUI-64 identifier from the system running this algorithm</span>
    <span class="n">eui64</span> <span class="o">=</span> <span class="n">_get_EUI64</span><span class="p">();</span>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">eui64</span>    <span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">64</span>
    <span class="c1"># 3) Concatenate</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">eui64</span><span class="p">;</span>             <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span>      <span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">128</span>
    <span class="c1"># 4) Compute an SHA-1 digest on the key</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="n">sha</span><span class="o">.</span><span class="n">sha</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="c1"># 5) least significant 40 bits</span>
    <span class="n">global_id</span> <span class="o">=</span> <span class="n">digest</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:];</span>     <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">global_id</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">40</span>
    <span class="c1"># 6) Concatenate FC00::/7, the L bit set to 1, and global_id</span>
    <span class="c1"># fc00::/7 plus L bit set -&gt; fd00::</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\xfd</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">global_id</span><span class="p">;</span> <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span>   <span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">48</span>
    <span class="n">packed</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="o">*</span> <span class="mi">10</span><span class="p">;</span>  <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">packed</span>   <span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">128</span>
    <span class="k">return</span> <span class="n">packed</span>


<span class="k">def</span> <span class="nf">calc_multiple_LAGIDs</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate several &#39;Locally Assigned Global IDs&#39; at once. A ramdom</span>
<span class="sd">    delay (up to 1 second) is put between calculations to decrease</span>
<span class="sd">    depentences between the generated values.</span>

<span class="sd">    This is usefull for getting severl LAG-IDs to select a &#39;nice&#39; one.</span>
<span class="sd">    (Well, this may not be in the sence of the RFC ;-)</span>

<span class="sd">    num : Number of LAG-IDs to generate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">calc_LAGID</span><span class="p">()</span>
        <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ps</span>

<span class="k">def</span> <span class="nf">asString</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a LAG-ID into a string representation (IPv6 address</span>
<span class="sd">    format).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s1">&#39;inet_ntop&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntop</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">IPy</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;0x&#39;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%02x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>  <span class="n">prefix</span> <span class="p">])</span>
        <span class="k">return</span> <span class="n">IPy</span><span class="o">.</span><span class="n">IP</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">strCompressed</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_main</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">calc_multiple_LAGIDs</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">print</span> <span class="s2">&quot;Your &#39;Locally Assigned Global ID&#39; is&quot;</span><span class="p">,</span>
        <span class="k">print</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/48&quot;</span> <span class="o">%</span> <span class="n">asString</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">_main</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ipv6-dad.html" class="btn btn-neutral float-right" title="Linux IPv6 DAD 相关配置" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="arp.html" class="btn btn-neutral" title="ARP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, @clan https://github.com/clan/clan.github.io/.
      最后更新于 2019-03-23 11:43.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/js/ga.js"></script>
      <script type="text/javascript" src="../_static/js/baidu.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>